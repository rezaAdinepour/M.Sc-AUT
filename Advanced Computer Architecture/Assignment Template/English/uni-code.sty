\RequirePackage{xcolor}
\RequirePackage{listings}
\RequirePackage{matlab-prettifier}
% default code style
% Default fixed font does not support bold face
\definecolor{codegreen}{rgb}{0,0.6,0}
\definecolor{codegray}{rgb}{0.5,0.5,0.5}
\definecolor{codeblue}{RGB}{49,49,255}
\definecolor{codeorange}{rgb}{1,0.49,0}
\definecolor{backcolour}{rgb}{0.95,0.95,0.96}
\lstdefinestyle{mystyle}{
backgroundcolor=\color{backcolour},
commentstyle=\color{codegray},
keywordstyle=\color{codeorange},
numberstyle=\small\color{codegray},
stringstyle=\color{codegreen},
basicstyle=\ttfamily\footnotesize,
moredelim=*[s][\colorIndex]{[}{]},
literate=*{:}{:}1,
breakatwhitespace=false,
breaklines=true,
%captionpos=b,
keepspaces=true,
numbers=left,
numbersep=5pt,
showspaces=false,
showstringspaces=false,
showtabs=false,
tabsize=8,
xleftmargin=3pt,
framexbottommargin=1pt,
mathescape=true,
frame=tb,
label={lst:code},
}
\lstset{style = mystyle}
\renewcommand\lstlistingname{Source Code}
\renewcommand\lstlistlistingname{Source Code}
% python
\lstdefinestyle{python-style}
{
  language=Python,
  basicstyle=\footnotesize\ttfamily,
  commentstyle=\color{codegray},
  morekeywords={self},              % Add keywords here
  keywordstyle=\color{codeblue},
  emph={MyClass,__init__},          % Custom highlighting
  emphstyle=\color{codeorange},    % Custom highlighting style
  stringstyle=\color{codegreen},
  frame=tb,                         % Any extra options here
  showstringspaces=false,
  label={lst:code:python},
  framexbottommargin=1pt,
}
% VHDL
\definecolor{light-gray}{gray}{0.96}
\definecolor{pageheading-gray}{gray}{0.2}
\definecolor{dark-gray}{gray}{0.45}
\definecolor{dark-green}{rgb}{0.245,0.121,0.0}

\lstdefinelanguage{VHDL}{
	morekeywords=[1]{
		ALL,ARCHITECTURE,ABS,AND,ASSERT,ARRAY,AFTER,ALIAS,%
		ACCESS,ATTRIBUTE,BEGIN,BODY,BUS,BLOCK,BUFFER,CONSTANT,CASE,%
		COMPONENT,CONFIGURATION,DOWNTO,ELSE,ELSIF,END,ENTITY,EXIT,%
		FUNCTION,FOR,FILE,GENERIC,GENERATE,GUARDED,GROUP,IF,IN,INOUT,IS,%
		INERTIAL,IMPURE,LIBRARY,LOOP,LABEL,LITERAL,LINKAGE,MAP,MOD,NOT,%
		NOR,NAND,NULL,NEXT,NEW,OUT,OF,OR,OTHERS,ON,OPEN,PROCESS,PORT,%
		PACKAGE,PURE,PROCEDURE,POSTPONED,RANGE,REM,ROL,ROR,REPORT,RECORD,%
		RETURN,REGISTER,REJECT,SIGNAL,SUBTYPE,SLL,SRL,SLA,SRA,SEVERITY,%
		SELECT,THEN,TYPE,TRANSPORT,TO,USE,UNITS,UNTIL,VARIABLE,WHEN,WAIT,%
		WHILE,XOR,XNOR,%
		DISCONNECT,ELIF,WITH}, % Arnaud Tisserand
	sensitive=f,% 1998 Gaurav Aggarwal
	morestring=[d]{"}%
	morekeywords=[2]{
		std_logic_vector,std_logic,std_logic_1164,numeric_std,numeric_signed,numeric_unsigned,numeric_bit,math_real,math_complex,
		unsigned,integer,
		rising_edge,to_integer,resize
	},
	morecomment=[l]--
}
\lstset{
	language=VHDL,
	basicstyle=\footnotesize\ttfamily,
	%basicstyle=\scriptsize\ttfamily, % font size for code
	%basicstyle=\tiny\ttfamily,
	lineskip= -1pt, % space between code lines (default: 0pt)
	%numbers=left,
	numberstyle=\tiny,
	%stepnumber=2,
	numbersep=5pt,
	aboveskip={0pt},
	tabsize=4,
	extendedchars=true,
	breaklines=true,
	classoffset=0,
	morecomment=[s][\textit]{my_lab}{el}, % make the label word italics
	otherkeywords={<=,:=, shared,=>,'}, % add <=, shared
	keywordstyle=\color{blue},
	keywordstyle = [2]\color{STD}\bfseries,
	commentstyle=\color[RGB]{10,140,20}, % green color
	frame=b, % turn on end line
	rulecolor=\color{dark-gray}, % end line color
	%captionpos=b, 
	belowcaptionskip=2pt,  
	stringstyle=\color{red}\ttfamily,
	morestring=[b]',
	showspaces=false,
	showtabs=false,
	xleftmargin=3pt,
	framexleftmargin=3pt,
	framexrightmargin=0pt,
	framexbottommargin=1pt,
	backgroundcolor=\color{light-gray},
	showstringspaces=false}

\usepackage[hang, bf, small]{caption}
\DeclareCaptionFont{white}{\color{white}}
\DeclareCaptionFormat{listing}{\colorbox{dark-gray}{\parbox[c][9pt][c]{\textwidth-6pt}{\hspace{3pt}#1#2#3}}} % I added -6pt (NOT SURE WHY !!)
\captionsetup[lstlisting]{format=listing,labelfont=white,textfont=white, singlelinecheck=false, margin=0pt, font={bf,scriptsize}}



% verilog
\definecolor{vgreen}{RGB}{104,180,104}
\definecolor{vblue}{RGB}{49,49,255}
\definecolor{vorange}{RGB}{255,143,102}
\lstdefinestyle{verilog-style}
{
language=Verilog,
basicstyle=\footnotesize\ttfamily,
backgroundcolor=\color{backcolour},
keywordstyle=\color{codeblue}\bfseries,
identifierstyle=\color{black},
commentstyle=\color{codegreen},
numbers=left,
numbersep=5pt,
tabsize=8,
moredelim=*[s][\colorIndex]{[}{]},
literate=*{:}{:}1,
breakatwhitespace=false,
breaklines=true,
%captionpos=b,
keepspaces=true,
xleftmargin=3pt,
mathescape=true,
label={lst:code:verilog},
frame=b,
}
\makeatletter
\newcommand*\@lbracket{[}
\newcommand*\@rbracket{]}
\newcommand*\@colon{:}
\newcommand*\colorIndex{%
  \edef\@temp{\the\lst@token}%
  \ifx\@temp\@lbracket \color{black}%
  \else\ifx\@temp\@rbracket \color{black}%
    \else\ifx\@temp\@colon \color{black}%
      \else \color{codeorange}%
      \fi\fi\fi
}

\newenvironment{matlab}{\begin{lstlisting}[style=Matlab-editor]
  }{\end{lstlisting}}
